name: ğŸ¯ Hunter Agent - Autonomous Lead Scraper

on:
  schedule:
    # Runs daily at 8:00 AM UTC
    - cron: '0 8 * * *'
  workflow_dispatch: # Allow manual triggers

permissions:
  contents: write
  issues: write

jobs:
  hunt:
    name: Execute Hunt Protocol
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Install Dependencies
        run: |
          cd apps/hunter-agent
          pip install -r requirements.txt
          playwright install chromium
          playwright install-deps chromium
      
      - name: ğŸ¯ Execute Hunter Agent
        run: |
          echo "ğŸ¯ INITIALIZING HUNTER PROTOCOL"
          echo "================================"
          cd apps/hunter-agent
          python main.py
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ğŸ“¤ Commit Lead Data
        run: |
          git config user.name "Construct-OS Hunter"
          git config user.email "hunter@construct-os.ai"
          git add data/raw-leads/
          if git diff --staged --quiet; then
            echo "No new leads to commit"
          else
            git commit -m "chore: Hunter agent discovered leads - $(date -u +%Y-%m-%d)"
            git push
          fi
      
      - name: ğŸ’¾ Archive Hunt Results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: hunt-results-${{ github.run_number }}
          path: apps/hunter-agent/output/
          retention-days: 30
      
      - name: ğŸš¨ Notify on Failure
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ğŸš¨ Hunter Agent Failure - ' + new Date().toISOString(),
              body: '**System Alert**: Hunter agent encountered an error during scheduled execution.\n\nWorkflow Run: ' + context.serverUrl + '/' + context.repo.owner + '/' + context.repo.repo + '/actions/runs/' + context.runId,
              labels: ['bug', 'automated', 'hunter-agent']
            })
